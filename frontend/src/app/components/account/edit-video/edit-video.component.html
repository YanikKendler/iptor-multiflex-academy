<h2>Description</h2>
<section class="basics">
  <div class="left">
    <app-textfield
      [(value)]="video.title"
      label="Title"
      placeholder="My amazing tutorial"
    ></app-textfield>

    <app-textfield
      [(value)]="video.description"
      label="Description"
      placeholder="In this tutorial you will learn..."
      [rows]="5"
    ></app-textfield>
  </div>
  <app-upload-video
    [videoFile]="video.videoFile ? video.videoFile : {videoFileId: -1}"
    (uploadFinished)="videoFileUpdated($event)"
  ></app-upload-video>
</section>

<h2 class="details">Details</h2>
<section class="details">
  <div>
    <p>video-color:</p>
    <input type="color" [value]="video.color" (input)="colorUpdated(color.value)" #color>
  </div>

  <mat-divider [vertical]="true"></mat-divider>

  <div>
    <p>visibility:</p>
    <app-dropdown [selectedId]="video.visibility" (optionSelected)="visibilityUpdated($event)" [options]="Utils.visibilityEnumAsDropdownOption()"></app-dropdown>
  </div>

  <mat-divider [vertical]="true"></mat-divider>

  <div class="tags" (click)="openTagPopup()">
    <p>tags:</p>
    <div class="tagList">
      @for(tag of video.tags; track tag.tagId){
        <app-chip [removable]="true" (onRemove)="removeTag(tag)">{{tag.name}}</app-chip>
      }
      <input type="text" #tagInput [cdkMenuTriggerFor]="tagPopup" placeholder="add tag" (input)="generateTagOptions(tagInput.value)" (focus)="generateTagOptions('')">
    </div>

    <ng-template #tagPopup>
      <div class="tagOptions" cdkMenu>
        @for(tag of tagOptions; track tag.tagId){
          <app-chip (click)="addTag(tag)">{{tag.name}}</app-chip>
        }
        @if(tagInput.value.length >= 2){
          <button mat-flat-button color="secondary" (click)="createTag(tagInput.value)">Create tag {{tagInput.value}}</button>
        }
        @else if(tagOptions.length == 0){
          <p class="no-results">No tags found</p>
        }
      </div>
    </ng-template>
  </div>
</section>

<h2>Questions</h2>
<section class="questions">
  <div class="left">
    @for (question of video.questions; track question.questionId){
      <p
        [class]="question.questionId == selectedQuestion.questionId ? 'selected' : ''"
        (click)="selectedQuestion = question"
      >
        <span class="number">{{ $index + 1 }}.</span>
        <span>{{ question.text }}</span>
      </p>
    }
    <button (click)="addQuestion()">
      <fa-icon [icon]="faPlus"></fa-icon>
    </button>
  </div>
  <mat-divider [vertical]="true"></mat-divider>
  <div class="right">
    <input type="text" class="question" placeholder="Frage" [value]="selectedQuestion.text" (input)="questionTitleUpdated(questionTitle.value)" #questionTitle>
    <div class="scrollable">
      @for (answer of selectedQuestion.answerOptions; track answer.answerOptionId) {
        <app-answer-option
          [answer]="answer"
          (answerChange)="answerUpdated(answerComponent.answer, $index)"
          [letter]="Utils.numberToLetter($index)"
          #answerComponent
        ></app-answer-option>
      }
      <button (click)="addAnswerOption()">add answer</button>
    </div>
  </div>
</section>

<div class="bottom">
  <button (click)="close()" mat-stroked-button color="secondary">close</button>
  <button (click)="saveChanges()" mat-flat-button color="secondary">save changes</button>
</div>
